

      John and Dan,

      Below is an example of a subroutine that should work
      to send data to OU. There are 4 user inputs.

      Note that this routine does a gzip on the file, then
      rcp's the file to the destination. The original file is
      deleted and replaced by the gzipped version.

      Dan had suggested an alternative involving the tar command, however
      I had trouble getting that to work. Perhaps that can be fixed.
      I noticed that it is difficult to include the single quotes from
      the tar command into FORTRAN character strings. I also don't know
      how to combine the tar and gzip commands in a way that avoids
      writing out an intermediate file. The tar file appears to be 
      best suited for copying many files/directories, here we are just 
      copying one file.

      Jennifer/Paula may have other scripts that are more efficient. Feel
      free to explore that possibility.

      If you choose to use this routine, please let me know if you find
      any bugs. I haven't actually run this yet, but it does compile.


                                                                     Steve


-------------------------------------------------------------------------------


     FILE rcptoremote.f


-------------------------------------------------------------------------------



      Subroutine rcp_to_remote(i4time,ext
     1                   ,destination_node,destination_dir)

!     You guessed it, copy forbidden data outside the LAB

      character*50 dir
      character*(*) destination_dir
      character*(*) destination_node
      character*200 command
      character*200 remote_command

      character*9 gtime
      character*31 ext,ext_in

      character*91 full_fname
      integer*4 len_fname

      write(6,*)' Subroutine rcp_to_remote'

      call s_len (destination_node,len_node)

      call s_len (destination_dir,len_dir)

!     Get ascii 9 time
      call make_fnam_lp(i4time,gtime,istatus)

!     Get directory to copy file from
      call downcase(ext,ext_in)
      call s_len(ext_in,len_ext)
      dir='../lapsprd/'//ext_in(1:len_ext)//'/'

!     Get full file name of file being copied
      call cvt_fname_data(dir,gtime,ext_in,full_fname,istatus)
      call s_len(full_fname,len_fname)

      write(6,*)full_fname

!     Generate full command

!     Option 1 - Use simple rcp command
      command = 'gzip '//full_fname(1:len_fname)//';'
     1             //' rcp '//full_fname(1:len_fname)//'* '
     1             //destination_node(1:len_node)
     1             //destination_dir(1:len_dir)

!     Option 2 - Use Dan's tar command
!     remote_command = '(cd '//destination_dir(1:len_dir)
!    1                       //'; tar -xf -)'
!     command = 'gzip '//full_fname(1:len_fname)
!    1                 //' | 'tar -cf | rsh '
!    1                 //destination_node(1:len_node)
!    1                 //remote_command 

      write(6,*)' Calling system with this command:'
      write(6,*)command

      call system(command)

      return
      end
