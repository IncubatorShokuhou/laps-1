#!@PERL@
#
# installroot is location of binaries (bin), scripts (etc),
# and installed data (data); otherwise it can be srcroot.
# laps_data_root is location of static, lapsprd, cdl, and
# so forth.

use strict;
umask 002;
use Getopt::Long;

my($LAPSINSTALLROOT,$LAPS_DATA_ROOT,$LAPS_SRC_ROOT,$cleandirs);
my $result = GetOptions("installroot=s" => \$LAPSINSTALLROOT,
                        "dataroot=s" => \$LAPS_DATA_ROOT,
                        "srcroot=s"  => \$LAPS_SRC_ROOT,
                        "cleandirs" => \$cleandirs);

$LAPS_SRC_ROOT = $ENV{LAPS_SRC_ROOT} if(! $LAPS_SRC_ROOT);
print "LAPS_SRC_ROOT = $LAPS_SRC_ROOT\n";

$LAPSINSTALLROOT = $LAPS_SRC_ROOT if(! $LAPSINSTALLROOT);
print "LAPSINSTALLROOT = $LAPSINSTALLROOT \n";

$LAPS_DATA_ROOT = "$LAPSINSTALLROOT/data" if(! $LAPS_DATA_ROOT);
print "LAPS_DATA_ROOT = $LAPS_DATA_ROOT\n";

if( ! -d $LAPS_DATA_ROOT ){
    print "copy $LAPS_SRC_ROOT/data to $LAPS_DATA_ROOT\n";
    system("cp -r $LAPS_SRC_ROOT/data $LAPS_DATA_ROOT");
}
if( defined($cleandirs)){
    system("rm -rf $LAPS_DATA_ROOT/lapsprd");
    mkdir "$LAPS_DATA_ROOT/lapsprd", 0777 or die "Can't make directory in $LAPS_DATA_ROOT/lapsprd $!\n"
}
require "$LAPSINSTALLROOT/etc/mkdatadirs.pm";
print "Using mkdatadir.pm to generate lapsdataroot directories\n";
mkdatadirs::mkdatadirs($LAPS_DATA_ROOT);
exit;
